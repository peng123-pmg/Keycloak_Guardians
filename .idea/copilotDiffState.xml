<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/API.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/API.md" />
              <option name="originalContent" value="1. 用户信息查询&#10;1.1.基本信息&#10;请求路径：/api/users/me&#10;请求方式：GET&#10;接口描述：该接口用于返回当前登录用户的基本信息和角色&#10;&#10;1.2 请求参数&#10;Authorization: Bearer &lt;access_token&gt;&#10;&#10;1.3 响应数据&#10;参数格式：application/json&#10;参数说明：&#10;-username：用户名&#10;-email：邮箱&#10;-roles：角色信息&#10;-userId：用户ID&#10;-welcome：请求成功返回信息&#10;&#10;响应数据样例：&#10;{&#10;    &quot;username&quot;: &quot;admin&quot;,&#10;    &quot;email&quot;: &quot;admin@example.com&quot;,&#10;    &quot;roles&quot;: [&#10;        &quot;admin&quot;,&#10;        &quot;user&quot;&#10;    ],&#10;    &quot;userId&quot;: &quot;b8d3ef6b-09bb-49d2-8829-b23f46778636&quot;,&#10;    &quot;welcome&quot;: &quot;欢迎回来，管理员!&quot;&#10;}&#10;&#10;2.1.用户信息概况&#10;请求路径：/api/user/stats&#10;请求方式：GET&#10;接口描述：该接口用于返回所有用户的统计信息&#10;&#10;2.2 请求参数&#10;Authorization: Bearer &lt;access_token&gt;&#10;&#10;2.3 响应数据&#10;参数格式：application/json&#10;参数说明：&#10;-message：请求成功返回信息&#10;-datal：数据&#10;-summary：数据总结&#10;-roleDistribution：根据角色区分的用户信息&#10;-registrationHistory：根据注册日期区分的用户信息&#10;-metadata：请求成功的信息&#10;&#10;响应数据样例：&#10;{&#10;    &quot;message&quot;: &quot;用户数据概览获取成功&quot;,&#10;    &quot;data&quot;: {&#10;        &quot;summary&quot;: {&#10;            &quot;总用户数&quot;: 3,&#10;            &quot;活跃用户&quot;: 3,&#10;            &quot;今日新增&quot;: 0&#10;        },&#10;        &quot;roleDistribution&quot;: [&#10;            {&#10;                &quot;角色&quot;: &quot;admin&quot;,&#10;                &quot;用户数&quot;: 1&#10;            },&#10;            {&#10;                &quot;角色&quot;: &quot;user&quot;,&#10;                &quot;用户数&quot;: 3&#10;            }&#10;        ],&#10;        &quot;registrationHistory&quot;: [&#10;            {&#10;                &quot;日期&quot;: &quot;2024-01-01&quot;,&#10;                &quot;注册人数&quot;: 1&#10;            },&#10;            {&#10;                &quot;日期&quot;: &quot;2024-01-02&quot;,&#10;                &quot;注册人数&quot;: 1&#10;            },&#10;            {&#10;                &quot;日期&quot;: &quot;2024-01-03&quot;,&#10;                &quot;注册人数&quot;: 1&#10;            }&#10;        ]&#10;    },&#10;    &quot;metadata&quot;: {&#10;        &quot;生成者&quot;: &quot;admin&quot;,&#10;        &quot;生成时间&quot;: &quot;2025-11-14 19:18:13&quot;,&#10;        &quot;timestamp&quot;: 1763119093385&#10;    }&#10;}&#10;&#10;3.1 创建用户&#10;请求路径：/api/admin/users&#10;请求方式：POST&#10;接口描述：该接口用于创建一个用户&#10;&#10;3.2 请求参数&#10;Authorization: Bearer &lt;access_token&gt;&#10;Content-Type：application/json&#10;body:{&#10;    &quot;username&quot;: &quot;&lt;用户名&gt;&quot;,&#10;    &quot;email&quot;: &quot;&lt;邮箱&gt;&quot;,&#10;    &quot;firstName&quot;: &quot;&lt;姓&gt;&quot;,&#10;    &quot;lastName&quot;: &quot;&lt;名&gt;&quot;,&#10;    &quot;enabled&quot;: &lt;true,&#10;    &quot;roles&quot;: [&quot;&lt;角色&gt;&quot;]&#10;}&#10;3.3 响应数据&#10;参数格式：application/json&#10;参数说明：&#10;-message：请求成功返回信息&#10;-user：用户数据&#10;-id：用户ID&#10;-username：用户名&#10;-email：邮箱&#10;-enabled：是否启用&#10;-roles：角色信息&#10;&#10;响应数据样例：&#10;{&#10;    &quot;message&quot;: &quot;用户创建成功&quot;,&#10;    &quot;user&quot;: {&#10;        &quot;id&quot;: &quot;user-1763119509679&quot;,&#10;        &quot;username&quot;: &quot;testuser&quot;,&#10;        &quot;email&quot;: &quot;test@example.com&quot;,&#10;        &quot;enabled&quot;: true,&#10;        &quot;roles&quot;: [&#10;            &quot;user&quot;&#10;        ]&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="1. 用户信息查询&#13;&#10;1.1.基本信息&#13;&#10;请求路径：/api/users/me&#13;&#10;请求方式：GET&#13;&#10;接口描述：该接口用于返回当前登录用户的基本信息和角色&#13;&#10;&#13;&#10;1.2 请求参数&#13;&#10;Authorization: Bearer &lt;access_token&gt;&#13;&#10;&#13;&#10;1.3 响应数据&#13;&#10;参数格式：application/json&#13;&#10;参数说明：&#13;&#10;-username：用户名&#13;&#10;-email：邮箱&#13;&#10;-roles：角色信息&#13;&#10;-userId：用户ID&#13;&#10;-welcome：请求成功返回信息&#13;&#10;&#13;&#10;响应数据样例：&#13;&#10;{&#13;&#10;    &quot;username&quot;: &quot;admin&quot;,&#13;&#10;    &quot;email&quot;: &quot;admin@example.com&quot;,&#13;&#10;    &quot;roles&quot;: [&#13;&#10;        &quot;admin&quot;,&#13;&#10;        &quot;user&quot;&#13;&#10;    ],&#13;&#10;    &quot;userId&quot;: &quot;b8d3ef6b-09bb-49d2-8829-b23f46778636&quot;,&#13;&#10;    &quot;welcome&quot;: &quot;欢迎回来，管理员!&quot;&#13;&#10;}&#13;&#10;&#13;&#10;2. 用户信息概况&#13;&#10;2.1 基本信息&#13;&#10;请求路径：/api/user/stats&#13;&#10;请求方式：GET&#13;&#10;接口描述：返回所有用户及其文件概况，需要 admin 角色&#13;&#10;&#13;&#10;2.2 请求参数&#13;&#10;Authorization: Bearer &lt;access_token&gt;&#13;&#10;&#13;&#10;2.3 响应数据&#13;&#10;参数格式：application/json&#13;&#10;字段说明：&#13;&#10;- message：请求结果描述&#13;&#10;- data.summary：概览信息&#13;&#10;  - totalOwners：至少上传过一次的用户数&#13;&#10;  - activeOwners：有 ACTIVE 文件的用户数&#13;&#10;  - totalFiles：有效文件总数&#13;&#10;  - storageUsedBytes：占用字节数&#13;&#10;  - storageUsedReadable：人类可读格式&#13;&#10;  - averageFileSizeBytes：平均单个文件大小&#13;&#10;- data.filesByStatus：按状态统计&#13;&#10;- data.topUsersByStorage：Top5 用户（文件数、存储量）&#13;&#10;- data.generatedAt：生成时间 (ISO-8601)&#13;&#10;&#13;&#10;响应示例：&#13;&#10;```&#13;&#10;{&#13;&#10;  &quot;message&quot;: &quot;用户数据概览获取成功&quot;,&#13;&#10;  &quot;data&quot;: {&#13;&#10;    &quot;summary&quot;: {&#13;&#10;      &quot;totalOwners&quot;: 2,&#13;&#10;      &quot;activeOwners&quot;: 2,&#13;&#10;      &quot;totalFiles&quot;: 5,&#13;&#10;      &quot;storageUsedBytes&quot;: 7340032,&#13;&#10;      &quot;storageUsedReadable&quot;: &quot;7.0 MB&quot;,&#13;&#10;      &quot;averageFileSizeBytes&quot;: 1468006&#13;&#10;    },&#13;&#10;    &quot;filesByStatus&quot;: {&#13;&#10;      &quot;ACTIVE&quot;: 4,&#13;&#10;      &quot;ARCHIVED&quot;: 1&#13;&#10;    },&#13;&#10;    &quot;topUsersByStorage&quot;: [&#13;&#10;      {&#13;&#10;        &quot;ownerId&quot;: &quot;user-123&quot;,&#13;&#10;        &quot;fileCount&quot;: 3,&#13;&#10;        &quot;storageBytes&quot;: 6291456&#13;&#10;      }&#13;&#10;    ],&#13;&#10;    &quot;generatedAt&quot;: &quot;2025-11-23T10:43:21.123456Z&quot;&#13;&#10;  }&#13;&#10;}&#13;&#10;```&#13;&#10;&#13;&#10;3. 用户管理&#13;&#10;3.1 创建用户&#13;&#10;请求路径：/api/admin/users&#13;&#10;请求方式：POST&#13;&#10;接口描述：该接口用于创建一个用户&#13;&#10;&#13;&#10;3.2 请求参数&#13;&#10;Authorization: Bearer &lt;access_token&gt;&#13;&#10;Content-Type：application/json&#13;&#10;body:{&#13;&#10;    &quot;username&quot;: &quot;&lt;用户名&gt;&quot;,&#13;&#10;    &quot;email&quot;: &quot;&lt;邮箱&gt;&quot;,&#13;&#10;    &quot;firstName&quot;: &quot;&lt;姓&gt;&quot;,&#13;&#10;    &quot;lastName&quot;: &quot;&lt;名&gt;&quot;,&#13;&#10;    &quot;enabled&quot;: &lt;true,&#13;&#10;    &quot;roles&quot;: [&quot;&lt;角色&gt;&quot;]&#13;&#10;}&#13;&#10;3.3 响应数据&#13;&#10;参数格式：application/json&#13;&#10;参数说明：&#13;&#10;-message：请求成功返回信息&#13;&#10;-user：用户数据&#13;&#10;-id：用户ID&#13;&#10;-username：用户名&#13;&#10;-email：邮箱&#13;&#10;-enabled：是否启用&#13;&#10;-roles：角色信息&#13;&#10;&#13;&#10;响应数据样例：&#13;&#10;{&#13;&#10;    &quot;message&quot;: &quot;用户创建成功&quot;,&#13;&#10;    &quot;user&quot;: {&#13;&#10;        &quot;id&quot;: &quot;user-1763119509679&quot;,&#13;&#10;        &quot;username&quot;: &quot;testuser&quot;,&#13;&#10;        &quot;email&quot;: &quot;test@example.com&quot;,&#13;&#10;        &quot;enabled&quot;: true,&#13;&#10;        &quot;roles&quot;: [&#13;&#10;            &quot;user&quot;&#13;&#10;        ]&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/docs/wiki/API.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/wiki/API.md" />
              <option name="updatedContent" value="# IAM-KC API 文档（Wiki 版本）&#10;&#10;&gt; 本文件会同步 GitHub Wiki，保持与项目 `API.md` 一致。下文仅包含关键接口，更多场景可参考源码。&#10;&#10;## 1. `GET /api/users/me`&#10;- **描述**：返回当前登录用户信息&#10;- **鉴权**：Bearer Token&#10;- **响应示例**：参考仓库根目录 `API.md`&#10;&#10;## 2. `GET /api/user/stats`&#10;- **描述**：管理员查看用户与文件全局态势&#10;- **鉴权**：需要 `admin` 角色&#10;- **返回字段**：&#10;  - `summary.totalOwners`、`summary.activeOwners`&#10;  - `summary.totalFiles`、`summary.storageUsedBytes`&#10;  - `summary.storageUsedReadable`、`summary.averageFileSizeBytes`&#10;  - `filesByStatus`：各状态统计&#10;  - `topUsersByStorage`：Top5 用户的文件数与占用&#10;  - `generatedAt`：ISO-8601 时间戳&#10;- **响应示例**：与项目 `API.md` 中 2.3 节一致&#10;&#10;## 3. `POST /api/admin/users`&#10;- **描述**：管理员创建 Keycloak 用户&#10;- **鉴权**：`admin`&#10;- **请求体**：用户名、邮箱、姓名、启用状态、角色数组&#10;- **响应**：成功返回用户 ID 与基础信息&#10;&#10;## 4. 统一约定&#10;- 所有接口统一返回 JSON，失败时包含 `error` 字段。&#10;- Postman 集合位于 `postman/Keycloak-Guardians.postman_collection.json`，用以验证字段格式与权限要求。&#10;&#10;&gt; Wiki 推送步骤：复制本文件内容到 GitHub Wiki 仓库（`*.wiki.git`），提交后通知团队即可。&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/README.md" />
              <option name="originalContent" value="# Keycloak_Guardians 后端服务运行指南&#10;&#10;## 项目简介&#10;本项目为 Keycloak 资源服务器后端，基于 Quarkus + Kotlin，支持 OIDC/JWT 校验，适配 Keycloak 作为统一认证授权中心。已集成典型用户、角色、权限自动化配置，便于前端和其他成员对接。&#10;&#10;## 运行环境&#10;- JDK 17+&#10;- Gradle 8+&#10;- Keycloak 22+（推荐使用 guardians realm，已提供 realm-import.json）&#10;&#10;## 快速启动&#10;1. **导入 Keycloak realm**&#10;   - 登录 Keycloak 管理后台&#10;   - 选择“添加 realm”，导入 `src/main/resources/realm-import.json`&#10;   - 启动 guardians realm，确保 `backend-service` client 已启用&#10;&#10;2. **启动后端服务**&#10;   - 进入项目根目录：&#10;     ```&#10;     cd keycloak-server&#10;     ```&#10;   - 启动开发模式：&#10;     ```&#10;     ./gradlew quarkusDev&#10;     ```&#10;   - 服务默认监听端口：`8081`&#10;&#10;3. **获取 Token（Postman 示例）**&#10;   - 请求 URL：`http://localhost:8080/realms/guardians/protocol/openid-connect/token`&#10;   - Body 类型：`x-www-form-urlencoded`&#10;     - grant_type: password&#10;     - client_id: backend-service&#10;     - username: admin（或 alice、jdoe）&#10;     - password: admin（或 alice、jdoe）&#10;   - 获取 access_token 后，访问受保护接口：&#10;     - URL：`http://localhost:8081/api/users/me`&#10;     - Header：`Authorization: Bearer &lt;access_token&gt;`&#10;&#10;## 典型接口&#10;- `GET /api/users/me`：返回当前登录用户的基本信息和角色&#10;- `GET /api/user/stats`：返回所有用户的统计信息&#10;- `POST /api/admin/users`：创建一个用户&#10;  - Header：&#10;    - `Authorization: Bearer &lt;access_token&gt;`&#10;    - `Contene-Type: application/json&#10;  - Body选择raw输入(例)：&#10;  {&#10;  &quot;username&quot;: &quot;testuser&quot;,&#10;  &quot;email&quot;: &quot;test@example.com&quot;,&#10;  &quot;firstName&quot;: &quot;Test&quot;,&#10;  &quot;lastName&quot;: &quot;User&quot;,&#10;  &quot;enabled&quot;: true,&#10;  &quot;roles&quot;: [&quot;user&quot;]&#10;  }&#10;&#10;## 常见问题&#10;- 若 roles 字段为空，请检查 Keycloak realm 的 protocol mappers 配置，确保 access_token 中包含角色信息&#10;- 若 Quarkus 启动报错，请确认 JDK/Gradle 版本和依赖完整&#10;&#10;## 适配前端&#10;- 前端可通过 OIDC 登录流程获取 access_token，带 token 访问后端受保护接口&#10;- 推荐使用 axios/fetch 并设置 Authorization header&#10;&#10;## 其他说明&#10;- 如需扩展用户、角色、权限，请直接修改 `realm-import.json` 并重新导入&#10;- 支持自定义 API 扩展，详见 `src/main/kotlin/com/example/`&#10;&#10;---&#10;如有疑问请联系后端负责人或查阅 Keycloak 官方文档。&#10;" />
              <option name="updatedContent" value="# Keycloak_Guardians 后端服务运行指南&#10;&#10;## 项目简介&#10;本项目为 Keycloak 资源服务器后端，基于 Quarkus + Kotlin，支持 OIDC/JWT 校验，适配 Keycloak 作为统一认证授权中心。已集成典型用户、角色、权限自动化配置，便于前端和其他成员对接。&#10;&#10;## 运行环境&#10;- JDK 17+&#10;- Gradle 8+&#10;- Keycloak 22+（推荐使用 guardians realm，已提供 realm-import.json）&#10;&#10;## 数据库准备（MySQL 8.0 + Flyway）&#10;1. 安装并启动 MySQL 8.0，确保能通过 `mysql` CLI 连接。&#10;2. 使用 root 账号执行以下 SQL（可直接复制粘贴到终端��：&#10;    ```sql&#10;    CREATE DATABASE IF NOT EXISTS iamkc DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;&#10;    CREATE USER IF NOT EXISTS 'iamkc'@'%' IDENTIFIED BY 'iamkc';&#10;    GRANT ALL PRIVILEGES ON iamkc.* TO 'iamkc'@'%';&#10;    FLUSH PRIVILEGES;&#10;    ```&#10;3. （可选）根据实际环境修改 `MYSQL_JDBC_URL`、`MYSQL_USERNAME`、`MYSQL_PASSWORD` 环境变量，或直接编辑 `src/main/resources/application.properties`。&#10;4. 运行 Flyway 迁移创建核心表（包含 `files` 元数据表，定义见 `src/main/resources/db/migration/V1__create_files_table.sql`）：&#10;    ```powershell&#10;    cd keycloak-server&#10;    ./gradlew flywayMigrate&#10;    ```&#10;5. 确认数据库内出现 `files` 表及 `flyway_schema_history` 记录后，再启动后端服务。&#10;&#10;## 快速启动&#10;1. **导入 Keycloak realm**&#10;   - 登录 Keycloak 管理后台&#10;   - 选择“添加 realm”，导入 `src/main/resources/realm-import.json`&#10;   - 启动 guardians realm，确保 `backend-service` client 已启用&#10;&#10;2. **启动后端服务**&#10;   - 进入项目根目录：&#10;     ```&#10;     cd keycloak-server&#10;     ```&#10;   - 启动开发模式：&#10;     ```&#10;     ./gradlew quarkusDev&#10;     ```&#10;   - 服务默认监听端口：`8081`&#10;&#10;3. **获取 Token（Postman 示例）**&#10;   - 请求 URL：`http://localhost:8080/realms/guardians/protocol/openid-connect/token`&#10;   - Body 类型：`x-www-form-urlencoded`&#10;     - grant_type: password&#10;     - client_id: backend-service&#10;     - username: admin（或 alice、jdoe）&#10;     - password: admin（或 alice、jdoe）&#10;   - 获取 access_token 后，访问受保护接口：&#10;     - URL：`http://localhost:8081/api/users/me`&#10;     - Header：`Authorization: Bearer &lt;access_token&gt;`&#10;&#10;## 典型接口&#10;- `GET /api/users/me`：返回当前登录用户的基本信息和角色&#10;- `GET /api/user/stats`：返回所有用户的统计信息&#10;- `POST /api/admin/users`：创建一个用户&#10;  - Header：&#10;    - `Authorization: Bearer &lt;access_token&gt;`&#10;    - `Contene-Type: application/json&#10;  - Body选择raw输入(例)：&#10;  {&#10;  &quot;username&quot;: &quot;testuser&quot;,&#10;  &quot;email&quot;: &quot;test@example.com&quot;,&#10;  &quot;firstName&quot;: &quot;Test&quot;,&#10;  &quot;lastName&quot;: &quot;User&quot;,&#10;  &quot;enabled&quot;: true,&#10;  &quot;roles&quot;: [&quot;user&quot;]&#10;  }&#10;&#10;## 常见问题&#10;- 若 roles 字段为空，请检查 Keycloak realm 的 protocol mappers 配置，确保 access_token 中包含角色信息&#10;- 若 Quarkus 启动报错，请确认 JDK/Gradle 版本和依赖完整&#10;&#10;## 适配前端&#10;- 前端可通过 OIDC 登录流程获取 access_token，带 token 访问后端受保护接口&#10;- 推荐使用 axios/fetch 并设置 Authorization header&#10;&#10;## Postman 测试集&#10;- 集合文件：`postman/Keycloak-Guardians.postman_collection.json`&#10;- 导入后先运行 **Auth / 获取 Token** 请求，会自动把 `access_token` 保存到 `{{access_token}}` 变量；随后依次测试 `GET /api/users/me`、`GET /api/user/stats` 等接口，断言会校验状态码与关键字段格式。&#10;&#10;---&#10;如有疑问请联系后端负责人或查阅 Keycloak 官方文档。" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/build.gradle.kts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/build.gradle.kts" />
              <option name="originalContent" value="plugins {&#10;    id(&quot;io.quarkus&quot;) version &quot;3.9.3&quot;&#10;    kotlin(&quot;jvm&quot;) version &quot;1.9.22&quot;&#10;}&#10;&#10;repositories {&#10;    mavenCentral()&#10;    mavenLocal()&#10;}&#10;&#10;java {&#10;    toolchain {&#10;        languageVersion.set(JavaLanguageVersion.of(21))&#10;    }&#10;}&#10;&#10;kotlin {&#10;    jvmToolchain(21)&#10;}&#10;&#10;dependencies {&#10;    implementation(enforcedPlatform(&quot;io.quarkus:quarkus-bom:3.9.3&quot;))&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-oidc&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-jackson&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-qute&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-junit5&quot;)&#10;    testImplementation(&quot;io.rest-assured:rest-assured&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-test-security-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-openapi&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-arc&quot;)&#10;&#10;    // Keycloak Admin Client&#10;    implementation(&quot;org.keycloak:keycloak-admin-client:26.4.1&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-client:6.2.8.Final&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-jackson2-provider:6.2.8.Final&quot;)&#10;&#10;    // 确保 Jackson 版本兼容&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-databind:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-core:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-annotations:2.15.2&quot;)&#10;&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin:2.15.2&quot;)&#10;}&#10;&#10;tasks.withType&lt;JavaCompile&gt; {&#10;    sourceCompatibility = &quot;21&quot;&#10;    targetCompatibility = &quot;21&quot;&#10;}&#10;&#10;tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile&gt; {&#10;    kotlinOptions.jvmTarget = &quot;21&quot;&#10;}" />
              <option name="updatedContent" value="plugins {&#10;    id(&quot;io.quarkus&quot;) version &quot;3.9.3&quot;&#10;    kotlin(&quot;jvm&quot;) version &quot;1.9.22&quot;&#10;}&#10;&#10;repositories {&#10;    mavenCentral()&#10;    mavenLocal()&#10;}&#10;&#10;java {&#10;    toolchain {&#10;        languageVersion.set(JavaLanguageVersion.of(21))&#10;    }&#10;}&#10;&#10;kotlin {&#10;    jvmToolchain(21)&#10;}&#10;&#10;dependencies {&#10;    implementation(enforcedPlatform(&quot;io.quarkus:quarkus-bom:3.9.3&quot;))&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-oidc&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-jackson&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-qute&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-junit5&quot;)&#10;    testImplementation(&quot;io.rest-assured:rest-assured&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-test-security-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-openapi&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-arc&quot;)&#10;&#10;    // Keycloak Admin Client&#10;    implementation(&quot;org.keycloak:keycloak-admin-client:26.4.1&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-client:6.2.8.Final&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-jackson2-provider:6.2.8.Final&quot;)&#10;&#10;    // 确保 Jackson 版本兼容&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-databind:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-core:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-annotations:2.15.2&quot;)&#10;&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin:2.15.2&quot;)&#10;&#10;    // Flyway and MySQL dependencies&#10;    implementation(&quot;io.quarkus:quarkus-flyway&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-jdbc-mysql&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-agroal&quot;)&#10;}&#10;&#10;tasks.withType&lt;JavaCompile&gt; {&#10;    sourceCompatibility = &quot;21&quot;&#10;    targetCompatibility = &quot;21&quot;&#10;}&#10;&#10;tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile&gt; {&#10;    kotlinOptions.jvmTarget = &quot;21&quot;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/config/DatabaseConfig.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/config/DatabaseConfig.kt" />
              <option name="updatedContent" value="package com.example.config&#10;&#10;import io.agroal.api.AgroalDataSource&#10;import jakarta.enterprise.context.ApplicationScoped&#10;import jakarta.enterprise.inject.Produces&#10;import javax.sql.DataSource&#10;&#10;@ApplicationScoped&#10;class DatabaseConfig(&#10;    private val dataSource: AgroalDataSource&#10;) {&#10;&#10;    @Produces&#10;    fun produceDataSource(): DataSource = dataSource&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/models/responses/UserStats.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/models/responses/UserStats.kt" />
              <option name="originalContent" value="&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.models.responses&#10;&#10;import java.time.OffsetDateTime&#10;&#10;data class UserStats(&#10;    val summary: UserStatsSummary,&#10;    val filesByStatus: Map&lt;String, Long&gt;,&#10;    val topUsersByStorage: List&lt;UserStorageEntry&gt;,&#10;    val generatedAt: OffsetDateTime = OffsetDateTime.now()&#10;)&#10;&#10;data class UserStatsSummary(&#10;    val totalOwners: Long,&#10;    val activeOwners: Long,&#10;    val totalFiles: Long,&#10;    val storageUsedBytes: Long,&#10;    val storageUsedReadable: String,&#10;    val averageFileSizeBytes: Long&#10;)&#10;&#10;data class UserStorageEntry(&#10;    val ownerId: String,&#10;    val fileCount: Long,&#10;    val storageBytes: Long&#10;)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/resources/UserStatsResource.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/resources/UserStatsResource.kt" />
              <option name="originalContent" value="package com.example.resources&#10;&#10;import jakarta.ws.rs.GET&#10;import jakarta.ws.rs.Path&#10;import jakarta.ws.rs.Produces&#10;import jakarta.ws.rs.core.MediaType&#10;import jakarta.ws.rs.core.Response&#10;import org.eclipse.microprofile.jwt.JsonWebToken&#10;import jakarta.inject.Inject&#10;import com.example.models.responses.DailyRegistration&#10;import jakarta.annotation.security.RolesAllowed&#10;import com.example.utils.RoleUtils&#10;import jakarta.enterprise.context.ApplicationScoped&#10;import java.text.SimpleDateFormat&#10;import java.util.Date&#10;&#10;@Path(&quot;/api/user&quot;)&#10;@ApplicationScoped&#10;class UserStatsResource @Inject constructor(&#10;    private val jwt: JsonWebToken&#10;) {&#10;&#10;    @GET&#10;    @Path(&quot;/stats&quot;)&#10;    @Produces(MediaType.APPLICATION_JSON)&#10;    @RolesAllowed(&quot;admin&quot;)&#10;    fun getUserStats(): Response {&#10;        if (!RoleUtils.hasAdminRole(jwt)) {&#10;            return Response.status(Response.Status.FORBIDDEN)&#10;                .entity(mapOf(&quot;error&quot; to &quot;权限不足，需要管理员角色&quot;))&#10;                .build()&#10;        }&#10;&#10;        try {&#10;            // 使用模拟数据，避免 Keycloak Admin Client 兼容性问题&#10;            // 在实际项目中，这些数据应该从数据库或 Keycloak 获取&#10;            val stats = mapOf(&#10;                &quot;message&quot; to &quot;用户数据概览获取成功&quot;,&#10;                &quot;data&quot; to mapOf(&#10;                    &quot;summary&quot; to mapOf(&#10;                        &quot;总用户数&quot; to 3,&#10;                        &quot;活跃用户&quot; to 3,&#10;                        &quot;今日新增&quot; to 0&#10;                    ),&#10;                    &quot;roleDistribution&quot; to listOf(&#10;                        mapOf(&quot;角色&quot; to &quot;admin&quot;, &quot;用户数&quot; to 1),&#10;                        mapOf(&quot;角色&quot; to &quot;user&quot;, &quot;用户数&quot; to 3),&#10;                        mapOf(&quot;角色&quot; to &quot;user_premium&quot;, &quot;用户数&quot; to 1)&#10;                    ),&#10;                    &quot;registrationHistory&quot; to listOf(&#10;                        mapOf(&quot;日期&quot; to &quot;2024-01-01&quot;, &quot;注册人数&quot; to 1),&#10;                        mapOf(&quot;日期&quot; to &quot;2024-01-02&quot;, &quot;注册人数&quot; to 1),&#10;                        mapOf(&quot;日期&quot; to &quot;2024-01-03&quot;, &quot;注册人数&quot; to 1)&#10;                    )&#10;                ),&#10;                &quot;metadata&quot; to mapOf(&#10;                    &quot;生成者&quot; to jwt.name,&#10;                    &quot;生成时间&quot; to SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(Date()),&#10;                    &quot;timestamp&quot; to System.currentTimeMillis()&#10;                )&#10;            )&#10;&#10;            return Response.ok(stats).build()&#10;        } catch (e: Exception) {&#10;            e.printStackTrace()&#10;            return Response.status(Response.Status.INTERNAL_SERVER_ERROR)&#10;                .entity(mapOf(&quot;error&quot; to &quot;获取统计数据失败: ${e.message}&quot;))&#10;                .build()&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.resources&#13;&#10;&#13;&#10;import com.example.services.UserStatsService&#13;&#10;import jakarta.ws.rs.GET&#13;&#10;import jakarta.ws.rs.Path&#13;&#10;import jakarta.ws.rs.Produces&#13;&#10;import jakarta.ws.rs.core.MediaType&#13;&#10;import jakarta.ws.rs.core.Response&#13;&#10;import org.eclipse.microprofile.jwt.JsonWebToken&#13;&#10;import jakarta.inject.Inject&#13;&#10;import jakarta.annotation.security.RolesAllowed&#13;&#10;import com.example.utils.RoleUtils&#13;&#10;import jakarta.enterprise.context.ApplicationScoped&#13;&#10;&#13;&#10;@Path(&quot;/api/user&quot;)&#13;&#10;@ApplicationScoped&#13;&#10;class UserStatsResource @Inject constructor(&#13;&#10;    private val jwt: JsonWebToken,&#13;&#10;    private val statsService: UserStatsService&#13;&#10;) {&#13;&#10;&#13;&#10;    @GET&#13;&#10;    @Path(&quot;/stats&quot;)&#13;&#10;    @Produces(MediaType.APPLICATION_JSON)&#13;&#10;    @RolesAllowed(&quot;admin&quot;)&#13;&#10;    fun getUserStats(): Response {&#13;&#10;        if (!RoleUtils.hasAdminRole(jwt)) {&#13;&#10;            return Response.status(Response.Status.FORBIDDEN)&#13;&#10;                .entity(mapOf(&quot;error&quot; to &quot;权限不足，需要管理员角色&quot;))&#13;&#10;                .build()&#13;&#10;        }&#13;&#10;&#13;&#10;        return try {&#13;&#10;            val stats = statsService.fetchStats()&#13;&#10;            Response.ok(mapOf(&#13;&#10;                &quot;message&quot; to &quot;用户数据概览获取成功&quot;,&#13;&#10;                &quot;data&quot; to stats&#13;&#10;            )).build()&#13;&#10;        } catch (e: Exception) {&#13;&#10;            Response.status(Response.Status.INTERNAL_SERVER_ERROR)&#13;&#10;                .entity(mapOf(&quot;error&quot; to &quot;获取统计数据失败: ${e.message}&quot;))&#13;&#10;                .build()&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/services/UserStatsService.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/kotlin/com/example/services/UserStatsService.kt" />
              <option name="originalContent" value="&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.services&#10;&#10;import com.example.models.responses.UserStats&#10;import com.example.models.responses.UserStatsSummary&#10;import com.example.models.responses.UserStorageEntry&#10;import jakarta.enterprise.context.ApplicationScoped&#10;import java.sql.Connection&#10;import javax.sql.DataSource&#10;&#10;@ApplicationScoped&#10;class UserStatsService(&#10;    private val dataSource: DataSource&#10;) {&#10;&#10;    fun fetchStats(): UserStats {&#10;        dataSource.connection.use { conn -&gt;&#10;            val totalFiles = scalarLong(conn, &quot;SELECT COUNT(*) FROM files WHERE deleted_at IS NULL&quot;)&#10;            val storageUsedBytes = scalarLong(conn, &quot;SELECT COALESCE(SUM(size_bytes),0) FROM files WHERE deleted_at IS NULL&quot;)&#10;            val totalOwners = scalarLong(conn, &quot;SELECT COUNT(DISTINCT owner_id) FROM files WHERE deleted_at IS NULL&quot;)&#10;            val activeOwners = scalarLong(conn, &quot;SELECT COUNT(DISTINCT owner_id) FROM files WHERE status = 'ACTIVE' AND deleted_at IS NULL&quot;)&#10;            val filesByStatus = mapQuery(conn, &quot;SELECT status, COUNT(*) FROM files GROUP BY status&quot;)&#10;            val topUsers = topUsers(conn)&#10;&#10;            val summary = UserStatsSummary(&#10;                totalOwners = totalOwners,&#10;                activeOwners = activeOwners,&#10;                totalFiles = totalFiles,&#10;                storageUsedBytes = storageUsedBytes,&#10;                storageUsedReadable = humanReadable(storageUsedBytes),&#10;                averageFileSizeBytes = if (totalFiles &gt; 0) storageUsedBytes / totalFiles else 0&#10;            )&#10;&#10;            return UserStats(&#10;                summary = summary,&#10;                filesByStatus = filesByStatus,&#10;                topUsersByStorage = topUsers&#10;            )&#10;        }&#10;    }&#10;&#10;    private fun scalarLong(conn: Connection, sql: String): Long = conn.prepareStatement(sql).use { ps -&gt;&#10;        ps.executeQuery().use { rs -&gt; if (rs.next()) rs.getLong(1) else 0 }&#10;    }&#10;&#10;    private fun mapQuery(conn: Connection, sql: String): Map&lt;String, Long&gt; = conn.prepareStatement(sql).use { ps -&gt;&#10;        ps.executeQuery().use { rs -&gt;&#10;            val result = mutableMapOf&lt;String, Long&gt;()&#10;            while (rs.next()) {&#10;                result[rs.getString(1)] = rs.getLong(2)&#10;            }&#10;            result&#10;        }&#10;    }&#10;&#10;    private fun topUsers(conn: Connection): List&lt;UserStorageEntry&gt; = conn.prepareStatement(&#10;        &quot;&quot;&quot;&#10;            SELECT owner_id, COUNT(*) AS file_count, COALESCE(SUM(size_bytes),0) AS bytes&#10;            FROM files&#10;            WHERE deleted_at IS NULL&#10;            GROUP BY owner_id&#10;            ORDER BY bytes DESC&#10;            LIMIT 5&#10;        &quot;&quot;&quot;.trimIndent()&#10;    ).use { ps -&gt;&#10;        ps.executeQuery().use { rs -&gt;&#10;            val list = mutableListOf&lt;UserStorageEntry&gt;()&#10;            while (rs.next()) {&#10;                list += UserStorageEntry(&#10;                    ownerId = rs.getString(&quot;owner_id&quot;),&#10;                    fileCount = rs.getLong(&quot;file_count&quot;),&#10;                    storageBytes = rs.getLong(&quot;bytes&quot;)&#10;                )&#10;            }&#10;            list&#10;        }&#10;    }&#10;&#10;    private fun humanReadable(bytes: Long): String {&#10;        if (bytes &lt;= 0) return &quot;0 B&quot;&#10;        val units = arrayOf(&quot;B&quot;, &quot;KB&quot;, &quot;MB&quot;, &quot;GB&quot;, &quot;TB&quot;)&#10;        val digitGroups = (Math.log10(bytes.toDouble()) / Math.log10(1024.0)).toInt()&#10;        return String.format(&quot;%.1f %s&quot;, bytes / Math.pow(1024.0, digitGroups.toDouble()), units[digitGroups])&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/resources/application.properties">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/resources/application.properties" />
              <option name="originalContent" value="# Keycloak ?? - ??????8080??&#10;quarkus.oidc.auth-server-url=http://localhost:8080/realms/guardians&#10;quarkus.oidc.client-id=backend-service&#10;quarkus.oidc.application-type=service&#10;quarkus.oidc.tls.verification=none&#10;&#10;# JWT ??&#10;quarkus.smallrye-jwt.enabled=true&#10;&#10;# ????&#10;quarkus.http.auth.permission.roles.paths=/api/*&#10;quarkus.http.auth.permission.roles.policy=authenticated&#10;&#10;# Jackson JSON ??&#10;quarkus.jackson.fail-on-unknown-properties=false&#10;&#10;# ????&#10;quarkus.http.port=8081&#10;&#10;# CORS ??&#10;quarkus.http.cors=true&#10;quarkus.http.cors.origins=*&#10;&#10;# ????&#10;quarkus.log.level=INFO&#10;quarkus.log.category.&quot;com.example&quot;.level=DEBUG&#10;&#10;# ????&#10;quarkus.package.type=uber-jar&#10;&#10;# ????&#10;quarkus.live-reload.password=dev&#10;&#10;# Keycloak Admin Client ??&#10;keycloak.server.url=http://localhost:8080&#10;keycloak.realm=guardians&#10;keycloak.admin.client.id=admin-cli&#10;keycloak.admin.username=admin&#10;keycloak.admin.password=admin" />
              <option name="updatedContent" value="# Keycloak ?? - ??????8080??&#10;quarkus.oidc.auth-server-url=http://localhost:8080/realms/guardians&#10;quarkus.oidc.client-id=backend-service&#10;quarkus.oidc.application-type=service&#10;quarkus.oidc.tls.verification=none&#10;&#10;# JWT ??&#10;quarkus.smallrye-jwt.enabled=true&#10;&#10;# ????&#10;quarkus.http.auth.permission.roles.paths=/api/*&#10;quarkus.http.auth.permission.roles.policy=authenticated&#10;&#10;# Jackson JSON ??&#10;quarkus.jackson.fail-on-unknown-properties=false&#10;&#10;# ????&#10;quarkus.http.port=8081&#10;&#10;# CORS ??&#10;quarkus.http.cors=true&#10;quarkus.http.cors.origins=*&#10;&#10;# ????&#10;quarkus.log.level=INFO&#10;quarkus.log.category.&quot;com.example&quot;.level=DEBUG&#10;&#10;# ????&#10;quarkus.package.type=uber-jar&#10;&#10;# ????&#10;quarkus.live-reload.password=dev&#10;&#10;# Keycloak Admin Client ??&#10;keycloak.server.url=http://localhost:8080&#10;keycloak.realm=guardians&#10;keycloak.admin.client.id=admin-cli&#10;keycloak.admin.username=admin&#10;keycloak.admin.password=admin&#10;&#10;# Database&#10;quarkus.datasource.db-kind=mysql&#10;quarkus.datasource.jdbc.url=${MYSQL_JDBC_URL:jdbc:mysql://localhost:3306/iamkc?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true}&#10;quarkus.datasource.username=${MYSQL_USERNAME:iamkc}&#10;quarkus.datasource.password=${MYSQL_PASSWORD:iamkc}&#10;quarkus.datasource.jdbc.max-size=20&#10;&#10;# Flyway&#10;quarkus.flyway.migrate-at-start=true&#10;quarkus.flyway.baseline-on-migrate=true&#10;quarkus.flyway.table=flyway_schema_history" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/resources/db/migration/V1__create_files_table.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/resources/db/migration/V1__create_files_table.sql" />
              <option name="originalContent" value="CREATE TABLE IF NOT EXISTS files (&#10;    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,&#10;    owner_id VARCHAR(64) NOT NULL,&#10;    owner_realm VARCHAR(64) NOT NULL DEFAULT 'guardians',&#10;    file_name VARCHAR(255) NOT NULL,&#10;    storage_path VARCHAR(512) NOT NULL,&#10;    mime_type VARCHAR(128) NULL,&#10;    size_bytes BIGINT UNSIGNED NOT NULL DEFAULT 0,&#10;    status VARCHAR(32) NOT NULL DEFAULT 'ACTIVE',&#10;    checksum VARCHAR(128) NULL,&#10;    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;    deleted_at TIMESTAMP NULL,&#10;    PRIMARY KEY (id),&#10;    INDEX idx_files_owner (owner_id),&#10;    INDEX idx_files_status (status),&#10;    INDEX idx_files_created_at (created_at)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;&#10;" />
              <option name="updatedContent" value="CREATE TABLE IF NOT EXISTS files (&#10;    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,&#10;    owner_id VARCHAR(64) NOT NULL,&#10;    owner_realm VARCHAR(64) NOT NULL DEFAULT 'guardians',&#10;    file_name VARCHAR(255) NOT NULL,&#10;    storage_path VARCHAR(512) NOT NULL,&#10;    mime_type VARCHAR(128) NULL,&#10;    size_bytes BIGINT UNSIGNED NOT NULL DEFAULT 0,&#10;    status VARCHAR(32) NOT NULL DEFAULT 'ACTIVE',&#10;    checksum VARCHAR(128) NULL,&#10;    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;    deleted_at TIMESTAMP NULL,&#10;    PRIMARY KEY (id),&#10;    INDEX idx_files_owner (owner_id),&#10;    INDEX idx_files_status (status),&#10;    INDEX idx_files_created_at (created_at)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/postman/Keycloak-Guardians.postman_collection.json">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/postman/Keycloak-Guardians.postman_collection.json" />
              <option name="updatedContent" value="{&#10;  &quot;info&quot;: {&#10;    &quot;name&quot;: &quot;Keycloak Guardians&quot;,&#10;    &quot;schema&quot;: &quot;https://schema.getpostman.com/json/collection/v2.1.0/collection.json&quot;,&#10;    &quot;description&quot;: &quot;Postman collection covering token retrieval, user profile, and stats API&quot;&#10;  },&#10;  &quot;item&quot;: [&#10;    {&#10;      &quot;name&quot;: &quot;Auth / 获取 Token&quot;,&#10;      &quot;request&quot;: {&#10;        &quot;method&quot;: &quot;POST&quot;,&#10;        &quot;header&quot;: [&#10;          { &quot;key&quot;: &quot;Content-Type&quot;, &quot;value&quot;: &quot;application/x-www-form-urlencoded&quot; }&#10;        ],&#10;        &quot;body&quot;: {&#10;          &quot;mode&quot;: &quot;urlencoded&quot;,&#10;          &quot;urlencoded&quot;: [&#10;            { &quot;key&quot;: &quot;grant_type&quot;, &quot;value&quot;: &quot;password&quot; },&#10;            { &quot;key&quot;: &quot;client_id&quot;, &quot;value&quot;: &quot;backend-service&quot; },&#10;            { &quot;key&quot;: &quot;username&quot;, &quot;value&quot;: &quot;admin&quot; },&#10;            { &quot;key&quot;: &quot;password&quot;, &quot;value&quot;: &quot;admin&quot; }&#10;          ]&#10;        },&#10;        &quot;url&quot;: {&#10;          &quot;raw&quot;: &quot;{{keycloak_url}}/realms/guardians/protocol/openid-connect/token&quot;,&#10;          &quot;host&quot;: [&quot;{{keycloak_url}}&quot;],&#10;          &quot;path&quot;: [&quot;realms&quot;,&quot;guardians&quot;,&quot;protocol&quot;,&quot;openid-connect&quot;,&quot;token&quot;]&#10;        }&#10;      },&#10;      &quot;response&quot;: [],&#10;      &quot;event&quot;: [&#10;        {&#10;          &quot;listen&quot;: &quot;test&quot;,&#10;          &quot;script&quot;: {&#10;            &quot;type&quot;: &quot;text/javascript&quot;,&#10;            &quot;exec&quot;: [&#10;              &quot;const json = pm.response.json();&quot;,&#10;              &quot;pm.collectionVariables.set('access_token', json.access_token);&quot;&#10;            ]&#10;          }&#10;        }&#10;      ]&#10;    },&#10;    {&#10;      &quot;name&quot;: &quot;GET /api/users/me&quot;,&#10;      &quot;request&quot;: {&#10;        &quot;method&quot;: &quot;GET&quot;,&#10;        &quot;header&quot;: [&#10;          { &quot;key&quot;: &quot;Authorization&quot;, &quot;value&quot;: &quot;Bearer {{access_token}}&quot; }&#10;        ],&#10;        &quot;url&quot;: {&#10;          &quot;raw&quot;: &quot;{{api_base}}/api/users/me&quot;,&#10;          &quot;host&quot;: [&quot;{{api_base}}&quot;],&#10;          &quot;path&quot;: [&quot;api&quot;,&quot;users&quot;,&quot;me&quot;]&#10;        }&#10;      },&#10;      &quot;event&quot;: [&#10;        {&#10;          &quot;listen&quot;: &quot;test&quot;,&#10;          &quot;script&quot;: {&#10;            &quot;type&quot;: &quot;text/javascript&quot;,&#10;            &quot;exec&quot;: [&#10;              &quot;pm.test('status 200', () =&gt; pm.response.code === 200);&quot;,&#10;              &quot;const body = pm.response.json();&quot;,&#10;              &quot;pm.test('has username', () =&gt; body.username);&quot;,&#10;              &quot;pm.test('has roles array', () =&gt; Array.isArray(body.roles));&quot;&#10;            ]&#10;          }&#10;        }&#10;      ]&#10;    },&#10;    {&#10;      &quot;name&quot;: &quot;GET /api/user/stats&quot;,&#10;      &quot;request&quot;: {&#10;        &quot;method&quot;: &quot;GET&quot;,&#10;        &quot;header&quot;: [&#10;          { &quot;key&quot;: &quot;Authorization&quot;, &quot;value&quot;: &quot;Bearer {{access_token}}&quot; }&#10;        ],&#10;        &quot;url&quot;: {&#10;          &quot;raw&quot;: &quot;{{api_base}}/api/user/stats&quot;,&#10;          &quot;host&quot;: [&quot;{{api_base}}&quot;],&#10;          &quot;path&quot;: [&quot;api&quot;,&quot;user&quot;,&quot;stats&quot;]&#10;        }&#10;      },&#10;      &quot;event&quot;: [&#10;        {&#10;          &quot;listen&quot;: &quot;test&quot;,&#10;          &quot;script&quot;: {&#10;            &quot;type&quot;: &quot;text/javascript&quot;,&#10;            &quot;exec&quot;: [&#10;              &quot;pm.test('status 200', () =&gt; pm.response.code === 200);&quot;,&#10;              &quot;const body = pm.response.json();&quot;,&#10;              &quot;pm.test('message ok', () =&gt; body.message);&quot;,&#10;              &quot;pm.test('has summary', () =&gt; body.data &amp;&amp; body.data.summary);&quot;,&#10;              &quot;pm.test('has filesByStatus map', () =&gt; body.data &amp;&amp; body.data.filesByStatus);&quot;&#10;            ]&#10;          }&#10;        }&#10;      ]&#10;    }&#10;  ],&#10;  &quot;variable&quot;: [&#10;    { &quot;key&quot;: &quot;keycloak_url&quot;, &quot;value&quot;: &quot;http://localhost:8080&quot; },&#10;    { &quot;key&quot;: &quot;api_base&quot;, &quot;value&quot;: &quot;http://localhost:8081&quot; },&#10;    { &quot;key&quot;: &quot;access_token&quot;, &quot;value&quot;: &quot;&quot; }&#10;  ]&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>