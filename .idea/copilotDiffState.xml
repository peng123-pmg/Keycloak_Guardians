<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/docs/wiki/API.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/wiki/API.md" />
              <option name="originalContent" value="# IAM-KC API 文档（Wiki 版本）&#10;&#10;&gt; 本文件会同步 GitHub Wiki，保持与项目 `API.md` 一致。下文仅包含关键接口，更多场景可参考源码。&#10;&#10;## 1. `GET /api/users/me`&#10;- **描述**：返回当前登录用户信息&#10;- **鉴权**：Bearer Token&#10;- **响应示例**：参考仓库根目录 `API.md`&#10;&#10;## 2. `GET /api/user/stats`&#10;- **描述**：管理员查看用户与文件全局态势&#10;- **鉴权**：需要 `admin` 角色&#10;- **返回字段**：&#10;  - `summary.totalOwners`、`summary.activeOwners`&#10;  - `summary.totalFiles`、`summary.storageUsedBytes`&#10;  - `summary.storageUsedReadable`、`summary.averageFileSizeBytes`&#10;  - `filesByStatus`：各状态统计&#10;  - `topUsersByStorage`：Top5 用户的文件数与占用&#10;  - `generatedAt`：ISO-8601 时间戳&#10;- **响应示例**：与项目 `API.md` 中 2.3 节一致&#10;&#10;## 3. `POST /api/admin/users`&#10;- **描述**：管理员创建 Keycloak 用户&#10;- **鉴权**：`admin`&#10;- **请求体**：用户名、邮箱、姓名、启用状态、角色数组&#10;- **响应**：成功返回用户 ID 与基础信息&#10;&#10;## 4. 统一约定&#10;- 所有接口统一返回 JSON，失败时包含 `error` 字段。&#10;- Postman 集合位于 `postman/Keycloak-Guardians.postman_collection.json`，用以验证字段格式与权限要求。&#10;&#10;&gt; Wiki 推送步骤：复制本文件内容到 GitHub Wiki 仓库（`*.wiki.git`），提交后通知团队即可。&#10;" />
              <option name="updatedContent" value="# IAM-KC API 文档（Wiki 版本）&#10;&#10;&gt; 本文件会同步 GitHub Wiki，保持与项目 `API.md` 一致。下文仅包含关键接口，更多场景可参考源码。&#10;&#10;## 1. `GET /api/users/me`&#10;- **描述**：返回当前登录用户信息&#10;- **鉴权**：Bearer Token&#10;- **响应示例**：参考仓库根目录 `API.md`&#10;&#10;## 2. `GET /api/user/stats`&#10;- **描述**：管理员查看用户与文件全局态势&#10;- **鉴权**：需要 `admin` 角色&#10;- **返回字段**：&#10;  - `summary.totalOwners`、`summary.activeOwners`&#10;  - `summary.totalFiles`、`summary.storageUsedBytes`&#10;  - `summary.storageUsedReadable`、`summary.averageFileSizeBytes`&#10;  - `filesByStatus`：各状态统计&#10;  - `topUsersByStorage`：Top5 用户的文件数与占用&#10;  - `generatedAt`：ISO-8601 时间戳&#10;- **响应示例**：与项目 `API.md` 中 2.3 节一致&#10;&#10;## 3. `POST /api/admin/users`&#10;- **描述**：管理员创建 Keycloak 用户&#10;- **鉴权**：`admin`&#10;- **请求体**：用户名、邮箱、姓名、启用状态、角色数组&#10;- **响应**：成功返回用户 ID 与基础信息&#10;&#10;## 4. 统一约定&#10;- 所有接口统一返回 JSON，失败时包含 `error` 字段。&#10;- Postman 集合位于 `postman/Keycloak-Guardians.postman_collection.json`，用以验证字段格式与权限要求。&#10;&#10;&gt; Wiki 推送步骤：复制本文件内容到 GitHub Wiki 仓库（`*.wiki.git`），提交后通知团队即可。&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/build.gradle.kts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/build.gradle.kts" />
              <option name="originalContent" value="plugins {&#10;    id(&quot;io.quarkus&quot;) version &quot;3.15.1&quot;&#10;    kotlin(&quot;jvm&quot;) version &quot;2.0.21&quot;&#10;}&#10;&#10;repositories {&#10;    mavenCentral()&#10;    mavenLocal()&#10;    maven(&quot;https://repo.mysql.com/mysql&quot;)&#10;}&#10;&#10;java {&#10;    toolchain {&#10;        languageVersion.set(JavaLanguageVersion.of(17))&#10;    }&#10;}&#10;&#10;kotlin {&#10;    jvmToolchain(17)&#10;}&#10;&#10;dependencies {&#10;    implementation(enforcedPlatform(&quot;io.quarkus:quarkus-bom:3.15.1&quot;))&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-oidc&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-jackson&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-qute&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-junit5&quot;)&#10;    testImplementation(&quot;io.rest-assured:rest-assured&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-test-security-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-openapi&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-arc&quot;)&#10;&#10;    // Keycloak Admin Client&#10;    implementation(&quot;org.keycloak:keycloak-admin-client:26.4.1&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-client:6.2.8.Final&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-jackson2-provider:6.2.8.Final&quot;)&#10;&#10;    // 确保 Jackson 版本兼容&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-databind:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-core:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-annotations:2.15.2&quot;)&#10;&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin:2.15.2&quot;)&#10;&#10;    // MySQL dependencies&#10;    implementation(&quot;io.quarkus:quarkus-jdbc-mysql&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-agroal&quot;)&#10;    implementation(&quot;com.mysql:mysql-connector-j:8.3.0&quot;)&#10;}&#10;&#10;tasks.withType&lt;JavaCompile&gt; {&#10;    sourceCompatibility = &quot;17&quot;&#10;    targetCompatibility = &quot;17&quot;&#10;}&#10;&#10;tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile&gt; {&#10;    kotlinOptions.jvmTarget = &quot;17&quot;&#10;}&#10;&#10;val mysqlUrl = (System.getenv(&quot;MYSQL_JDBC_URL&quot;) ?: project.findProperty(&quot;mysqlUrl&quot;) as String?)&#10;    ?: &quot;jdbc:mysql://localhost:3306/iamkc?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&quot;&#10;val mysqlUser = (System.getenv(&quot;MYSQL_USERNAME&quot;) ?: project.findProperty(&quot;mysqlUser&quot;) as String?) ?: &quot;iamkc&quot;&#10;val mysqlPassword = (System.getenv(&quot;MYSQL_PASSWORD&quot;) ?: project.findProperty(&quot;mysqlPassword&quot;) as String?) ?: &quot;iamkc&quot;&#10;&#10;configurations.all {&#10;    resolutionStrategy.eachDependency {&#10;        if (requested.group == &quot;mysql&quot; &amp;&amp; requested.name == &quot;mysql-connector-java&quot;) {&#10;            useTarget(&quot;com.mysql:mysql-connector-j:${requested.version}&quot;)&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="plugins {&#10;    id(&quot;io.quarkus&quot;) version &quot;3.15.1&quot;&#10;    kotlin(&quot;jvm&quot;) version &quot;2.0.21&quot;&#10;}&#10;&#10;repositories {&#10;    mavenCentral()&#10;    mavenLocal()&#10;    maven(&quot;https://repo.mysql.com/mysql&quot;)&#10;}&#10;&#10;java {&#10;    toolchain {&#10;        languageVersion.set(JavaLanguageVersion.of(17))&#10;    }&#10;}&#10;&#10;kotlin {&#10;    jvmToolchain(17)&#10;}&#10;&#10;dependencies {&#10;    implementation(enforcedPlatform(&quot;io.quarkus:quarkus-bom:3.15.1&quot;))&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-oidc&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-jackson&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-resteasy-reactive-qute&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-junit5&quot;)&#10;    testImplementation(&quot;io.rest-assured:rest-assured&quot;)&#10;    testImplementation(&quot;io.quarkus:quarkus-test-security-jwt&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-smallrye-openapi&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-arc&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-flyway&quot;)&#10;&#10;    // Keycloak Admin Client&#10;    implementation(&quot;org.keycloak:keycloak-admin-client:26.4.1&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-client:6.2.8.Final&quot;)&#10;    implementation(&quot;org.jboss.resteasy:resteasy-jackson2-provider:6.2.8.Final&quot;)&#10;&#10;    // 确保 Jackson 版本兼容&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-databind:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-core:2.15.2&quot;)&#10;    implementation(&quot;com.fasterxml.jackson.core:jackson-annotations:2.15.2&quot;)&#10;&#10;    implementation(&quot;com.fasterxml.jackson.module:jackson-module-kotlin:2.15.2&quot;)&#10;&#10;    // MySQL dependencies&#10;    implementation(&quot;io.quarkus:quarkus-jdbc-mysql&quot;)&#10;    implementation(&quot;io.quarkus:quarkus-agroal&quot;)&#10;    implementation(&quot;com.mysql:mysql-connector-j:8.3.0&quot;)&#10;}&#10;&#10;tasks.withType&lt;JavaCompile&gt; {&#10;    sourceCompatibility = &quot;17&quot;&#10;    targetCompatibility = &quot;17&quot;&#10;}&#10;&#10;tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile&gt; {&#10;    kotlinOptions.jvmTarget = &quot;17&quot;&#10;}&#10;&#10;val mysqlUrl = (System.getenv(&quot;MYSQL_JDBC_URL&quot;) ?: project.findProperty(&quot;mysqlUrl&quot;) as String?)&#10;    ?: &quot;jdbc:mysql://localhost:3306/iamkc?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&quot;&#10;val mysqlUser = (System.getenv(&quot;MYSQL_USERNAME&quot;) ?: project.findProperty(&quot;mysqlUser&quot;) as String?) ?: &quot;iamkc&quot;&#10;val mysqlPassword = (System.getenv(&quot;MYSQL_PASSWORD&quot;) ?: project.findProperty(&quot;mysqlPassword&quot;) as String?) ?: &quot;iamkc&quot;&#10;&#10;configurations.all {&#10;    resolutionStrategy.eachDependency {&#10;        if (requested.group == &quot;mysql&quot; &amp;&amp; requested.name == &quot;mysql-connector-java&quot;) {&#10;            useTarget(&quot;com.mysql:mysql-connector-j:${requested.version}&quot;)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/resources/application.properties">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/resources/application.properties" />
              <option name="originalContent" value="# Keycloak ?? - ??????8080??&#10;quarkus.oidc.auth-server-url=http://localhost:8080/realms/guardians&#10;quarkus.oidc.client-id=backend-service&#10;quarkus.oidc.application-type=service&#10;quarkus.oidc.tls.verification=none&#10;&#10;# JWT ??&#10;quarkus.smallrye-jwt.enabled=true&#10;&#10;# ????&#10;quarkus.http.auth.permission.roles.paths=/api/*&#10;quarkus.http.auth.permission.roles.policy=authenticated&#10;&#10;# Jackson JSON ??&#10;quarkus.jackson.fail-on-unknown-properties=false&#10;&#10;# ????&#10;quarkus.http.port=8081&#10;&#10;# CORS ??&#10;quarkus.http.cors=true&#10;quarkus.http.cors.origins=*&#10;&#10;# ????&#10;quarkus.log.level=INFO&#10;quarkus.log.category.&quot;com.example&quot;.level=DEBUG&#10;&#10;# ????&#10;quarkus.package.type=uber-jar&#10;&#10;# ????&#10;quarkus.live-reload.password=dev&#10;&#10;# Keycloak Admin Client ??&#10;keycloak.server.url=http://localhost:8080&#10;keycloak.realm=guardians&#10;keycloak.admin.client.id=admin-cli&#10;keycloak.admin.username=admin&#10;keycloak.admin.password=admin&#10;&#10;# Database&#10;quarkus.datasource.db-kind=mysql&#10;quarkus.datasource.jdbc.url=${MYSQL_JDBC_URL:jdbc:mysql://localhost:3306/iamkc?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true}&#10;quarkus.datasource.username=${MYSQL_USERNAME:iamkc}&#10;quarkus.datasource.password=${MYSQL_PASSWORD:iamkc}&#10;quarkus.datasource.jdbc.max-size=20&#10;&#10;# Flyway&#10;quarkus.flyway.migrate-at-start=true&#10;quarkus.flyway.baseline-on-migrate=true&#10;quarkus.flyway.table=flyway_schema_history" />
              <option name="updatedContent" value="# Keycloak ?? - ??????8080??&#10;quarkus.oidc.auth-server-url=http://localhost:8080/realms/guardians&#10;quarkus.oidc.client-id=backend-service&#10;quarkus.oidc.application-type=service&#10;quarkus.oidc.tls.verification=none&#10;&#10;# JWT ??&#10;quarkus.smallrye-jwt.enabled=true&#10;&#10;# ????&#10;quarkus.http.auth.permission.roles.paths=/api/*&#10;quarkus.http.auth.permission.roles.policy=authenticated&#10;&#10;# Jackson JSON ??&#10;quarkus.jackson.fail-on-unknown-properties=false&#10;&#10;# ????&#10;quarkus.http.port=8081&#10;&#10;# CORS ??&#10;quarkus.http.cors=true&#10;quarkus.http.cors.origins=*&#10;&#10;# ????&#10;quarkus.log.level=INFO&#10;quarkus.log.category.&quot;com.example&quot;.level=DEBUG&#10;&#10;# ????&#10;quarkus.package.type=uber-jar&#10;&#10;# ????&#10;quarkus.live-reload.password=dev&#10;&#10;# Keycloak Admin Client ??&#10;keycloak.server.url=http://localhost:8080&#10;keycloak.realm=guardians&#10;keycloak.admin.client.id=admin-cli&#10;keycloak.admin.username=admin&#10;keycloak.admin.password=admin&#10;&#10;# Database&#10;quarkus.datasource.db-kind=mysql&#10;quarkus.datasource.jdbc.url=${MYSQL_JDBC_URL:jdbc:mysql://localhost:3306/iamkc?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true}&#10;quarkus.datasource.username=${MYSQL_USERNAME:iamkc}&#10;quarkus.datasource.password=${MYSQL_PASSWORD:iamkc}&#10;quarkus.datasource.jdbc.max-size=20&#10;&#10;# Flyway&#10;quarkus.flyway.migrate-at-start=true&#10;quarkus.flyway.baseline-on-migrate=true&#10;quarkus.flyway.table=flyway_schema_history" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/keycloak-server/src/main/resources/db/migration/V1__create_files_table.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/keycloak-server/src/main/resources/db/migration/V1__create_files_table.sql" />
              <option name="originalContent" value="CREATE TABLE IF NOT EXISTS files (&#10;    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,&#10;    owner_id VARCHAR(64) NOT NULL,&#10;    owner_realm VARCHAR(64) NOT NULL DEFAULT 'guardians',&#10;    file_name VARCHAR(255) NOT NULL,&#10;    storage_path VARCHAR(512) NOT NULL,&#10;    mime_type VARCHAR(128) NULL,&#10;    size_bytes BIGINT UNSIGNED NOT NULL DEFAULT 0,&#10;    status VARCHAR(32) NOT NULL DEFAULT 'ACTIVE',&#10;    checksum VARCHAR(128) NULL,&#10;    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;    deleted_at TIMESTAMP NULL,&#10;    PRIMARY KEY (id),&#10;    INDEX idx_files_owner (owner_id),&#10;    INDEX idx_files_status (status),&#10;    INDEX idx_files_created_at (created_at)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;&#10;" />
              <option name="updatedContent" value="CREATE TABLE IF NOT EXISTS files (&#10;    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,&#10;    owner_id VARCHAR(64) NOT NULL,&#10;    owner_realm VARCHAR(64) NOT NULL DEFAULT 'guardians',&#10;    file_name VARCHAR(255) NOT NULL,&#10;    storage_path VARCHAR(512) NOT NULL,&#10;    mime_type VARCHAR(128) NULL,&#10;    size_bytes BIGINT UNSIGNED NOT NULL DEFAULT 0,&#10;    status VARCHAR(32) NOT NULL DEFAULT 'ACTIVE',&#10;    checksum VARCHAR(128) NULL,&#10;    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;    deleted_at TIMESTAMP NULL,&#10;    PRIMARY KEY (id),&#10;    INDEX idx_files_owner (owner_id),&#10;    INDEX idx_files_status (status),&#10;    INDEX idx_files_created_at (created_at)&#10;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>