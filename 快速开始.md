# 🚀 快速开始指南

> 5分钟快速上手后端API对接

---

## 📦 第一步：安装依赖

```bash
npm install
```

**说明**: 安装新添加的 `axios` 依赖

---

## 🎮 第二步：选择工作模式

### 模式A：Mock模式（默认，推荐开发时使用）

✅ **优点**：
- 无需启动后端服务
- 响应速度快
- 数据稳定可预测

✅ **配置**：
```env
# .env (保持默认)
VITE_USE_MOCK_AUTH=true
```

✅ **测试账号**：
- admin / 123456
- alice / alice  
- jdoe / jdoe

✅ **直接运行**：
```bash
npm run dev
# 访问 http://localhost:5173
```

---

### 模式B：真实API模式（联调时使用）

⚠️ **前提条件**：
- [ ] Keycloak运行在 `http://localhost:8080`
- [ ] 后端服务运行在 `http://localhost:8081`

✅ **配置**：
```env
# .env
VITE_USE_MOCK_AUTH=false
VITE_BACKEND_URL=http://localhost:8081
VITE_KEYCLOAK_URL=http://localhost:8080
```

✅ **启动后端**：
```bash
# 进入后端目录
cd keycloak-server

# 启动服务
./gradlew quarkusDev
# Windows: gradlew.bat quarkusDev
```

✅ **启动前端**：
```bash
npm run dev
```

✅ **测试账号**：
使用Keycloak中配置的真实账号（询问彭茂刚）

---

## 🔍 第三步：验证是否成功

### 方法1：查看控制台日志

**Mock模式**：
```
🔧 使用 Mock 认证服务 (开发模式)
✅ Mock登录成功: admin
```

**真实API模式**：
```
🔐 使用 Keycloak 认证服务 (生产模式)
🔐 开始Keycloak登录流程...
✅ Token获取成功
✅ 用户信息获取成功
```

### 方法2：使用测试工具

打开浏览器控制台，执行：
```javascript
// 测试后端连接
import { testBackendConnection, printTestResults } from './src/utils/testBackend';
const results = await testBackendConnection();
printTestResults(results);

// 查看认证状态
import { getAuthSummary } from './src/services/authUtils';
console.log(getAuthSummary());
```

---

## 💻 在代码中使用

### 示例1：登录
```typescript
import { authService } from '@/services/authService';

const handleLogin = async () => {
  const result = await authService.login({
    username: 'admin',
    password: '123456'
  });

  if (result.success) {
    console.log('登录成功!', result.user);
    navigate('/dashboard');
  } else {
    console.error('登录失败:', result.error);
  }
};
```

### 示例2：获取用户信息
```typescript
import { authService } from '@/services/authService';

const loadUser = async () => {
  const user = await authService.getCurrentUser();
  if (user) {
    console.log('当前用户:', user);
    setCurrentUser(user);
  }
};
```

### 示例3：调用API
```typescript
import { userService } from '@/services/userService';

// 获取统计数据（需要admin权限）
const loadStats = async () => {
  try {
    const stats = await userService.getUserStats();
    console.log('统计数据:', stats);
  } catch (error) {
    console.error('获取失败:', error);
  }
};
```

### 示例4：检查权限
```typescript
import { isAuthenticated, hasRole, isAdmin } from '@/services/authUtils';

// 检查是否登录
if (isAuthenticated()) {
  console.log('用户已登录');
}

// 检查是否有admin角色
if (isAdmin()) {
  console.log('用户是管理员');
}

// 检查特定角色
if (hasRole('user_premium')) {
  console.log('用户是高级会员');
}
```

---

## 🐛 常见问题

### Q1: 页面显示"用户名或密码错误"
**A**: 
- Mock模式：使用 admin/123456、alice/alice 或 jdoe/jdoe
- 真实API模式：使用Keycloak中配置的账号

### Q2: 提示"无法连接到认证服务器"
**A**:
1. 检查 `.env` 中的 `VITE_USE_MOCK_AUTH`
2. 如果是 `false`，确保后端服务已启动：
   ```bash
   curl http://localhost:8081/health
   ```

### Q3: CORS跨域错误
**A**: 后端已配置CORS，如仍有问题，联系彭茂刚检查后端配置

### Q4: Token过期怎么办
**A**: 系统会自动清除过期Token并提示重新登录

---

## 📚 更多文档

- 📖 **详细使用说明**: `后端对接使用说明.md`
- 🔧 **技术对接文档**: `前端对接指南.md`  
- 📊 **实施总结**: `实施完成总结.md`
- 🏗️ **系统架构**: `系统架构说明.md`

---

## 🎯 重要提示

### ✅ 你不需要修改现有页面代码
所有页面已经在使用 `authService`，只需要：
1. 安装依赖
2. 选择模式（Mock/真实API）
3. 继续开发你的UI

### ✅ Mock和真实API可以随时切换
只需修改一个环境变量：
```env
VITE_USE_MOCK_AUTH=true   # Mock模式
VITE_USE_MOCK_AUTH=false  # 真实API模式
```

### ✅ 所有功能都已实现
- ✅ 登录/登出
- ✅ Token管理
- ✅ 用户信息获取
- ✅ 权限检查
- ✅ 错误处理
- ✅ API调用

---

## 📞 需要帮助？

1. 查看详细文档（上面的"更多文档"部分）
2. 使用测试工具诊断问题
3. 查看浏览器控制台日志
4. 询问AI助手或联系团队成员

---

**祝开发顺利！** 🎉
