# ç³»ç»Ÿæ¶æ„è¯´æ˜

## ğŸ“ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯åº”ç”¨ (React)                          â”‚
â”‚                     http://localhost:5173                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UI Pages    â”‚   â”‚  Service Layer   â”‚   â”‚  Components  â”‚
â”‚               â”‚   â”‚                  â”‚   â”‚              â”‚
â”‚ - Dashboard   â”‚â”€â”€â”€â”‚ - authService    â”‚   â”‚ - Sidebar    â”‚
â”‚ - Login       â”‚   â”‚ - userService    â”‚   â”‚ - Button     â”‚
â”‚ - Teams       â”‚   â”‚ - apiClient      â”‚   â”‚ - Input      â”‚
â”‚ - Messages    â”‚   â”‚ - authUtils      â”‚   â”‚ - ...        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
            Mockæ¨¡å¼ â”‚          çœŸå®APIæ¨¡å¼ â”‚
                    â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  MockAuthService â”‚   â”‚ KeycloakAuthService â”‚
        â”‚                  â”‚   â”‚                     â”‚
        â”‚ è¿”å›æ¨¡æ‹Ÿæ•°æ®      â”‚   â”‚ è°ƒç”¨çœŸå®åç«¯API      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚                   â”‚
                    â–¼                   â–¼                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Keycloak Server  â”‚  â”‚  Backend API    â”‚  â”‚   Database   â”‚
        â”‚  (è®¤è¯æˆæƒæœåŠ¡)    â”‚  â”‚  (ä¸šåŠ¡æ¥å£)      â”‚  â”‚  (æ•°æ®å­˜å‚¨)   â”‚
        â”‚                   â”‚  â”‚                 â”‚  â”‚              â”‚
        â”‚ Port: 8080        â”‚  â”‚ Port: 8081      â”‚  â”‚ PostgreSQL   â”‚
        â”‚ Realm: guardians  â”‚  â”‚ Quarkus+Kotlin  â”‚  â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ è®¤è¯æµç¨‹å›¾

### Mockæ¨¡å¼æµç¨‹
```
ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
        â”‚
        â–¼
MockAuthService.login()
        â”‚
        â”œâ”€ éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆä»mockUsersæ•°ç»„ï¼‰
        â”œâ”€ ç”ŸæˆMock Token
        â”œâ”€ ä¿å­˜åˆ°localStorage
        â””â”€ è¿”å›ç™»å½•æˆåŠŸ
        â”‚
        â–¼
è·³è½¬åˆ°Dashboard
```

### çœŸå®APIæ¨¡å¼æµç¨‹
```
ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
        â”‚
        â–¼
KeycloakAuthService.login()
        â”‚
        â”œâ”€ Step 1: å‘Keycloakè¯·æ±‚Token
        â”‚   POST /realms/guardians/protocol/openid-connect/token
        â”‚   Body: grant_type=password, username=xxx, password=xxx
        â”‚   
        â”œâ”€ Step 2: KeycloakéªŒè¯å¹¶è¿”å›Token
        â”‚   Response: {access_token, refresh_token, expires_in}
        â”‚
        â”œâ”€ Step 3: ä½¿ç”¨Tokenè·å–ç”¨æˆ·ä¿¡æ¯
        â”‚   GET /api/users/me
        â”‚   Header: Authorization: Bearer <access_token>
        â”‚
        â”œâ”€ Step 4: åç«¯APIè¿”å›ç”¨æˆ·ä¿¡æ¯
        â”‚   Response: {username, email, roles, userId}
        â”‚
        â”œâ”€ Step 5: ä¿å­˜åˆ°localStorage
        â”‚   - currentUser: ç”¨æˆ·ä¿¡æ¯
        â”‚   - authTokens: Tokenä¿¡æ¯
        â”‚   - loginTime: ç™»å½•æ—¶é—´
        â”‚
        â””â”€ è¿”å›ç™»å½•æˆåŠŸ
        â”‚
        â–¼
è·³è½¬åˆ°Dashboard
```

---

## ğŸ“‚ æ–‡ä»¶ç»„ç»‡ç»“æ„

```
Keycloak_Guardians-main/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/              # æœåŠ¡å±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ authService.ts     # è®¤è¯æœåŠ¡ï¼ˆMock + Keycloakå®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ apiClient.ts       # APIå®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨Tokenç®¡ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ userService.ts     # ç”¨æˆ·APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ authUtils.ts       # è®¤è¯å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ fileService.ts     # æ–‡ä»¶æœåŠ¡
â”‚   â”‚   â””â”€â”€ types.ts           # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                 # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Dashboard/         # ä»ªè¡¨ç›˜
â”‚   â”‚   â”œâ”€â”€ LoginPage/         # ç™»å½•é¡µ
â”‚   â”‚   â”œâ”€â”€ MyTeams/           # æˆ‘çš„å›¢é˜Ÿ
â”‚   â”‚   â”œâ”€â”€ NotificationCenter/# é€šçŸ¥ä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ MessageDetail/     # æ¶ˆæ¯è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ TaskProgress/      # ä»»åŠ¡è¿›åº¦
â”‚   â”‚   â””â”€â”€ RecycleBin/        # å›æ”¶ç«™
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â”œâ”€â”€ Checkbox/
â”‚   â”‚   â”œâ”€â”€ FileUpload/
â”‚   â”‚   â””â”€â”€ GlobalSearch/
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ testBackend.ts     # åç«¯æµ‹è¯•å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ global.css
â”‚   â”‚   â””â”€â”€ variables.css
â”‚   â”‚
â”‚   â””â”€â”€ main.tsx               # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ .env                       # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ package.json               # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ tsconfig.json              # TypeScripté…ç½®
â”œâ”€â”€ vite.config.ts             # Viteé…ç½®
â”‚
â””â”€â”€ æ–‡æ¡£/
    â”œâ”€â”€ å‰ç«¯å¯¹æ¥æŒ‡å—.md
    â”œâ”€â”€ åç«¯å¯¹æ¥ä½¿ç”¨è¯´æ˜.md
    â””â”€â”€ å®æ–½å®Œæˆæ€»ç»“.md
```

---

## ğŸ” è®¤è¯æœåŠ¡æ¶æ„

### æ¥å£å®šä¹‰ï¼ˆIAuthServiceï¼‰
```typescript
interface IAuthService {
  login(request: LoginRequest): Promise<LoginResponse>;
  logout(): Promise<void>;
  refreshToken(refreshToken: string): Promise<TokenResponse>;
  getCurrentUser(): Promise<User | null>;
  validateToken(token: string): Promise<boolean>;
}
```

### ä¸¤ç§å®ç°

#### 1. MockAuthServiceï¼ˆå¼€å‘æ¨¡å¼ï¼‰
```typescript
class MockAuthService implements IAuthService {
  // ä½¿ç”¨å†…å­˜ä¸­çš„æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
  private mockUsers = [...]
  
  // æ‰€æœ‰æ–¹æ³•éƒ½è¿”å›æ¨¡æ‹Ÿæ•°æ®
  // ä¸éœ€è¦çœŸå®çš„åç«¯æœåŠ¡
}
```

#### 2. KeycloakAuthServiceï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
```typescript
class KeycloakAuthService implements IAuthService {
  // è°ƒç”¨çœŸå®çš„Keycloakå’Œåç«¯API
  
  login() {
    // 1. å‘Keycloakè¯·æ±‚Token
    // 2. ä½¿ç”¨Tokenè·å–ç”¨æˆ·ä¿¡æ¯
    // 3. ä¿å­˜åˆ°localStorage
  }
  
  logout() {
    // 1. è°ƒç”¨Keycloakç™»å‡ºç«¯ç‚¹
    // 2. æ¸…é™¤æœ¬åœ°Token
  }
  
  // ... å…¶ä»–æ–¹æ³•
}
```

### å·¥å‚æ¨¡å¼è‡ªåŠ¨é€‰æ‹©
```typescript
class AuthServiceFactory {
  static getService(): IAuthService {
    const useMock = import.meta.env.VITE_USE_MOCK_AUTH !== 'false';
    
    if (useMock) {
      return new MockAuthService();
    } else {
      return new KeycloakAuthService(config);
    }
  }
}

// å¯¼å‡ºå•ä¾‹
export const authService = AuthServiceFactory.getService();
```

---

## ğŸŒ APIå®¢æˆ·ç«¯æ¶æ„

### apiClientæ‹¦æˆªå™¨é“¾

```
HTTPè¯·æ±‚
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Requestæ‹¦æˆªå™¨       â”‚
â”‚                     â”‚
â”‚ 1. ä»localStorage   â”‚
â”‚    è¯»å–Token        â”‚
â”‚ 2. æ·»åŠ åˆ°Header:    â”‚
â”‚    Authorization:   â”‚
â”‚    Bearer <token>   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
å‘é€åˆ°åç«¯API
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Responseæ‹¦æˆªå™¨      â”‚
â”‚                     â”‚
â”‚ å¤„ç†HTTPçŠ¶æ€ç :      â”‚
â”‚ - 200: æˆåŠŸ         â”‚
â”‚ - 401: Tokenè¿‡æœŸ    â”‚
â”‚ - 403: æƒé™ä¸è¶³     â”‚
â”‚ - 404: èµ„æºä¸å­˜åœ¨   â”‚
â”‚ - 500: æœåŠ¡å™¨é”™è¯¯   â”‚
â”‚ - Network: ç½‘ç»œé”™è¯¯ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
è¿”å›ç»™è°ƒç”¨è€…
```

---

## ğŸ’¾ æ•°æ®æµå‘

### ç™»å½•æ•°æ®æµ
```
1. ç”¨æˆ·è¾“å…¥
   â†“
2. authService.login({username, password})
   â†“
3. [Mockæ¨¡å¼] â†’ è¿”å›æ¨¡æ‹Ÿæ•°æ®
   [çœŸå®API] â†’ KeycloakéªŒè¯ â†’ è·å–Token â†’ è°ƒç”¨åç«¯API
   â†“
4. ä¿å­˜åˆ°localStorage:
   - currentUser
   - authTokens
   - loginTime
   â†“
5. æ›´æ–°UIçŠ¶æ€
   â†“
6. è·³è½¬åˆ°Dashboard
```

### APIè°ƒç”¨æ•°æ®æµ
```
1. é¡µé¢è°ƒç”¨API
   â†“
2. apiClient.get('/api/users/me')
   â†“
3. Requestæ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ Token
   â†“
4. å‘é€åˆ°åç«¯ (http://localhost:8081/api/users/me)
   â†“
5. åç«¯éªŒè¯Tokenå¹¶è¿”å›æ•°æ®
   â†“
6. Responseæ‹¦æˆªå™¨å¤„ç†å“åº”
   â†“
7. è¿”å›æ•°æ®ç»™é¡µé¢
```

---

## ğŸ”§ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡å±‚çº§
```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½:

1. .env.local (æœ¬åœ°è¦†ç›–ï¼Œä¸æäº¤åˆ°Git)
2. .env.production (ç”Ÿäº§ç¯å¢ƒ)
3. .env (å¼€å‘ç¯å¢ƒï¼Œé»˜è®¤)
```

### é…ç½®é¡¹è¯´æ˜
```env
# è®¤è¯æ¨¡å¼å¼€å…³
VITE_USE_MOCK_AUTH=true|false
  â†“
  å†³å®šä½¿ç”¨å“ªä¸ªè®¤è¯æœåŠ¡å®ç°
  â†“
  true â†’ MockAuthService
  false â†’ KeycloakAuthService

# åç«¯æœåŠ¡åœ°å€
VITE_BACKEND_URL=http://localhost:8081
  â†“
  apiClientçš„baseURL
  â†“
  æ‰€æœ‰APIè¯·æ±‚çš„å‰ç¼€

# Keycloaké…ç½®
VITE_KEYCLOAK_URL=http://localhost:8080
VITE_KEYCLOAK_REALM=guardians
VITE_KEYCLOAK_CLIENT_ID=backend-service
  â†“
  ç”¨äºæ„å»ºKeycloak Tokenç«¯ç‚¹
  â†“
  POST {url}/realms/{realm}/protocol/openid-connect/token
```

---

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

### Tokenç®¡ç†
```
1. Tokenè·å–
   - ç™»å½•æˆåŠŸåä»Keycloakè·å–
   - åŒ…å«: access_token, refresh_token, expires_in

2. Tokenå­˜å‚¨
   - localStorage.authTokens
   - å­˜å‚¨æ ¼å¼: JSONå­—ç¬¦ä¸²

3. Tokenä½¿ç”¨
   - apiClientè‡ªåŠ¨ä»localStorageè¯»å–
   - è‡ªåŠ¨æ·»åŠ åˆ°Authorizationå¤´

4. TokenéªŒè¯
   - æ¯æ¬¡è¯·æ±‚åç«¯éƒ½ä¼šéªŒè¯
   - æ— æ•ˆTokenè¿”å›401

5. Tokenåˆ·æ–°
   - å·²å®ç°refreshToken()æ–¹æ³•
   - å¯åœ¨401é”™è¯¯æ—¶è‡ªåŠ¨è°ƒç”¨ï¼ˆå¯æ‰©å±•ï¼‰

6. Tokenæ¸…é™¤
   - ç™»å‡ºæ—¶æ¸…é™¤
   - 401é”™è¯¯æ—¶æ¸…é™¤
```

### æƒé™æ£€æŸ¥
```
1. è§’è‰²å­˜å‚¨
   - user.roles = ['admin', 'user']

2. æƒé™æ£€æŸ¥
   - hasRole('admin') â†’ æ£€æŸ¥æ˜¯å¦æœ‰adminè§’è‰²
   - isAdmin() â†’ å¿«æ·æ£€æŸ¥æ˜¯å¦ç®¡ç†å‘˜

3. APIçº§æƒé™
   - åç«¯éªŒè¯Tokenä¸­çš„è§’è‰²
   - 403 Forbidden â†’ æƒé™ä¸è¶³
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜æœºåˆ¶
```typescript
// ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
getCurrentUser() {
  // ä¼˜å…ˆä»localStorageè¯»å–ç¼“å­˜
  const cached = localStorage.getItem('currentUser');
  if (cached && isValid) {
    return cached;
  }
  
  // ç¼“å­˜æ— æ•ˆæ‰è¯·æ±‚åç«¯
  const user = await fetchFromBackend();
  localStorage.setItem('currentUser', user);
  return user;
}
```

### 2. è¯·æ±‚è¶…æ—¶
```typescript
// apiClienté…ç½®15ç§’è¶…æ—¶
timeout: 15000

// Keycloakç™»å½•é…ç½®10ç§’è¶…æ—¶
timeout: 10000
```

### 3. é”™è¯¯è¾¹ç•Œ
```typescript
// æ‰€æœ‰APIè°ƒç”¨éƒ½åŒ…å«try-catch
try {
  const result = await apiClient.get('/api/...');
  return result.data;
} catch (error) {
  console.error('APIè°ƒç”¨å¤±è´¥:', error);
  // è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯
  throw new Error('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
}
```

---

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•å±‚çº§
```
1. å•å…ƒæµ‹è¯• (æœªå®ç°ï¼Œå¯æ‰©å±•)
   - æµ‹è¯•å•ä¸ªå‡½æ•°/æ–¹æ³•
   - Jest + React Testing Library

2. é›†æˆæµ‹è¯• (å·²å®ç°)
   - testBackend.ts
   - æµ‹è¯•å‰åç«¯è¿æ¥
   - æµ‹è¯•ç™»å½•æµç¨‹

3. æ‰‹åŠ¨æµ‹è¯•
   - Mockæ¨¡å¼æµ‹è¯•
   - çœŸå®APIæ¨¡å¼æµ‹è¯•
   - æµè§ˆå™¨æ§åˆ¶å°è°ƒè¯•
```

### æµ‹è¯•å·¥å…·ä½¿ç”¨
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°

// 1. æµ‹è¯•åç«¯è¿æ¥
import { testBackendConnection } from '@/utils/testBackend';
const results = await testBackendConnection();

// 2. æµ‹è¯•ç™»å½•
import { testKeycloakLogin } from '@/utils/testBackend';
const result = await testKeycloakLogin('admin', 'admin');

// 3. æŸ¥çœ‹è®¤è¯çŠ¶æ€
import { getAuthSummary } from '@/services/authUtils';
console.log(getAuthSummary());
```

---

## ğŸ”„ æ‰©å±•å»ºè®®

### 1. æ·»åŠ æ–°çš„APIæ¥å£
```typescript
// åœ¨ userService.ts ä¸­æ·»åŠ 
async getTeamMembers(teamId: string) {
  const response = await apiClient.get(`/api/teams/${teamId}/members`);
  return response.data;
}
```

### 2. å®ç°è‡ªåŠ¨Tokenåˆ·æ–°
```typescript
// åœ¨ apiClient.ts çš„å“åº”æ‹¦æˆªå™¨ä¸­
if (error.response?.status === 401) {
  const tokens = getStoredTokens();
  if (tokens?.refreshToken) {
    // å°è¯•åˆ·æ–°Token
    const newTokens = await authService.refreshToken(tokens.refreshToken);
    // é‡è¯•åŸè¯·æ±‚
    return apiClient.request(originalRequest);
  }
}
```

### 3. æ·»åŠ è¯·æ±‚é‡è¯•
```bash
npm install axios-retry

# åœ¨ apiClient.ts ä¸­
import axiosRetry from 'axios-retry';
axiosRetry(apiClient, { retries: 3 });
```

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—çº§åˆ«
```
ğŸ”§ Debug   - å¼€å‘ä¿¡æ¯
ğŸ“¡ Info    - ä¸€èˆ¬ä¿¡æ¯
âš ï¸ Warning - è­¦å‘Šä¿¡æ¯
âŒ Error   - é”™è¯¯ä¿¡æ¯
âœ… Success - æˆåŠŸä¿¡æ¯
```

### å…³é”®æ—¥å¿—ç‚¹
```typescript
// 1. è®¤è¯æ¨¡å¼é€‰æ‹©
console.log('ğŸ”§ ä½¿ç”¨ Mock è®¤è¯æœåŠ¡ (å¼€å‘æ¨¡å¼)');
console.log('ğŸ” ä½¿ç”¨ Keycloak è®¤è¯æœåŠ¡ (ç”Ÿäº§æ¨¡å¼)');

// 2. ç™»å½•æµç¨‹
console.log('ğŸ” å¼€å§‹Keycloakç™»å½•æµç¨‹...');
console.log('âœ… Tokenè·å–æˆåŠŸ');
console.log('âœ… ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ:', user);

// 3. APIè°ƒç”¨
console.log('ğŸ“¡ ä»åç«¯è·å–ç”¨æˆ·ä¿¡æ¯...');
console.log('âœ… ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ:', user);

// 4. é”™è¯¯å¤„ç†
console.error('âŒ ç™»å½•å¤±è´¥:', error);
console.warn('âš ï¸ Tokenå·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•');
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. å·¥å‚æ¨¡å¼
```typescript
AuthServiceFactory.getService()
  â†“
æ ¹æ®ç¯å¢ƒå˜é‡åˆ›å»ºå¯¹åº”çš„æœåŠ¡å®ä¾‹
```

### 2. ç­–ç•¥æ¨¡å¼
```typescript
interface IAuthService {
  // å®šä¹‰ç»Ÿä¸€æ¥å£
}

class MockAuthService implements IAuthService {
  // Mockç­–ç•¥
}

class KeycloakAuthService implements IAuthService {
  // Keycloakç­–ç•¥
}
```

### 3. å•ä¾‹æ¨¡å¼
```typescript
export const authService = AuthServiceFactory.getService();
export const userService = new UserService();
```

### 4. æ‹¦æˆªå™¨æ¨¡å¼
```typescript
apiClient.interceptors.request.use(...)
apiClient.interceptors.response.use(...)
```

---

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ï¼š
- âœ… **çµæ´»æ€§**: Mock/çœŸå®APIè½»æ¾åˆ‡æ¢
- âœ… **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„åˆ†å±‚å’ŒèŒè´£åˆ’åˆ†
- âœ… **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- âœ… **å®‰å…¨æ€§**: å®Œå–„çš„Tokenç®¡ç†å’Œæƒé™æ§åˆ¶
- âœ… **ç”¨æˆ·ä½“éªŒ**: å‹å¥½çš„é”™è¯¯æç¤ºå’Œæ—¥å¿—è¾“å‡º
